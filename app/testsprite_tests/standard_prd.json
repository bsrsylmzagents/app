{
  "meta": {
    "project": "Travel Agency Management System (SaaS)",
    "date": "2025-11-19",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "A multi-tenant SaaS platform designed to streamline travel agency operations by integrating comprehensive modules for tour, hotel, customer, reservation, financial, and administrative management with modern technology stacks for scalable cloud deployment.",
  "core_goals": [
    "Provide isolated multi-tenant architecture to support multiple travel agencies securely.",
    "Enable seamless management of tours, hotels, and customer reservations with rich CRUD and calendar features.",
    "Implement robust financial management supporting multi-currency transactions and real-time currency updates.",
    "Support modular purchases and access control via Stripe integration and middleware.",
    "Automate hotel reservation synchronization using ICS calendar standards and reliable push mechanisms.",
    "Ensure secure, role-based user authentication and authorization with JWT and bcrypt.",
    "Offer detailed reporting capabilities across multiple operational domains for performance analysis and decision making."
  ],
  "key_features": [
    "Multi-tenant SaaS architecture with company-based data isolation.",
    "User authentication using JWT and role-based access control (admin, staff, customer).",
    "Company registration with auto-generated company codes for easy onboarding.",
    "Comprehensive reservation management including CRUD, calendar view, status tracking, and transport arrangements.",
    "Management of customer accounts, including detailed profiles, transactions, and password control.",
    "Financial tools for cash flow tracking, multi-currency handling, debt management, and payment configuration.",
    "Dynamic pricing management with seasonal and tour-type specific pricing.",
    "Extensive reporting modules covering income, expenses, performance, and customer analysis.",
    "Vehicle and service purchase inventory management.",
    "Modular system enabling Stripe-based module purchases and middleware access control.",
    "Full-feature hotel module with room management, ICS synchronization, reservation pushing with retry queues, and background scheduling.",
    "Store module featuring module listing, Stripe Checkout integration, and webhook payment event processing.",
    "Administrative features including staff management, company profile, settings, and module switching interface."
  ],
  "user_flow_summary": [
    "Users register companies and receive auto-generated company codes to support multi-tenant onboarding.",
    "Admin and staff authenticate via JWT secured login, and access their respective role-based dashboards.",
    "Users perform reservation CRUD operations and view bookings in calendar format; transport arrangements managed per reservation.",
    "Customer management workflows enable account access, updates, and transaction histories.",
    "Financial administrators configure payment types, monitor cash flow, and analyze debt/credit across currencies.",
    "Module management through store interface allows purchase and activation of optional features using Stripe Checkout.",
    "Hotel managers manage hotel inventory, synchronize calendar events via ICS feeds, and push reservation updates through retry-enabled queues.",
    "Administrators configure system settings, manage users, and review detailed reports for business insights."
  ],
  "validation_criteria": [
    "Multi-tenancy enforced with strict data isolation and role-based access control.",
    "Authentication and authorization flows secured via JWT and password hashing using bcrypt.",
    "Reservation, customer, hotel, and financial CRUD operations successfully persist and reflect real-time data changes.",
    "Stripe integration correctly processes payments, module purchases, and handles webhook events without failures.",
    "ICS calendar synchronization for hotels maintains consistency with external calendar data, with retries for failed pushes.",
    "Scheduled background jobs execute correctly for calendar sync and queue processing.",
    "Reporting modules generate accurate and comprehensive reports based on live data.",
    "Frontend routing and API integrations function smoothly with protected routes and error handling.",
    "Automated tests cover core backend modules, including access control, billing webhook handling, hotel push queue, and ICS sync operations."
  ],
  "code_summary": {
    "project_name": "Travel Agency Management System (SaaS)",
    "project_type": "full-stack",
    "description": "Multi-tenant SaaS travel agency management system with modular architecture supporting tour and hotel management modules",
    "tech_stack": {
      "frontend": {
        "framework": "React 18.2.0",
        "routing": "React Router DOM 6.22.0",
        "styling": "Tailwind CSS 3.4.17",
        "ui_components": "Radix UI components",
        "state_management": "React Context API",
        "form_handling": "React Hook Form 7.56.2 with Zod 3.24.4",
        "http_client": "Axios 1.8.4",
        "build_tool": "CRACO 7.1.0 (Create React App)",
        "other": [
          "date-fns 3.6.0",
          "jspdf 2.5.2",
          "recharts 2.15.4",
          "xlsx 0.18.5",
          "sonner 2.0.3 (toast notifications)"
        ]
      },
      "backend": {
        "framework": "FastAPI 0.110.1",
        "database": "MongoDB (Motor 3.3.1 async driver)",
        "authentication": "JWT (PyJWT 2.10.1)",
        "password_hashing": "bcrypt 4.1.3",
        "server": "Uvicorn 0.25.0",
        "other": [
          "Pydantic 2.12.4",
          "python-dotenv 1.2.1",
          "Stripe 10.8.0",
          "APScheduler 3.10.4",
          "iCalendar 5.0.11"
        ]
      },
      "deployment": {
        "frontend": "Vercel/Render",
        "backend": "Render/Uvicorn"
      }
    },
    "architecture": {
      "pattern": "Modular SaaS with multi-tenant architecture",
      "frontend_structure": {
        "pages": "React components in src/pages/",
        "components": "Reusable UI components in src/components/",
        "modules": "Feature modules in src/modules/ (store, admin, hotels)",
        "routing": "React Router with protected routes",
        "api_integration": "Axios-based API client"
      },
      "backend_structure": {
        "main_server": "server.py (FastAPI application)",
        "modules": "Pluggable modules in backend/modules/",
        "middleware": "Module access control, CORS, authentication",
        "database": "MongoDB collections per feature",
        "background_jobs": "APScheduler for scheduled tasks"
      }
    },
    "features": {
      "core_features": [
        "Multi-tenant SaaS architecture (company-based isolation)",
        "User authentication and authorization (JWT)",
        "Company registration with auto-generated company codes",
        "Role-based access control (admin, staff, customer)"
      ],
      "reservation_management": [
        "Reservation CRUD operations",
        "Calendar view for reservations",
        "Reservation status tracking",
        "Pickup and dropoff management"
      ],
      "customer_management": [
        "Customer accounts (Cari accounts)",
        "Individual customers (Munferit)",
        "Customer transactions",
        "Customer detail pages",
        "Password management for customer accounts"
      ],
      "financial_management": [
        "Cash flow tracking (income/expense)",
        "Payment types configuration",
        "Debt/credit management (Cari accounts)",
        "Transaction logging",
        "Multi-currency support (EUR, USD, TRY)",
        "Automatic currency rate updates"
      ],
      "pricing": [
        "Seasonal pricing management",
        "Dynamic pricing based on dates",
        "Tour type pricing"
      ],
      "reporting": [
        "Daily reports",
        "Income reports",
        "Expense reports",
        "Cash flow reports",
        "Customer analysis",
        "Performance reports",
        "Reservation reports",
        "Profit/loss reports",
        "Creditor/debtor reports"
      ],
      "inventory": [
        "Vehicle management",
        "Service purchases tracking"
      ],
      "modular_system": {
        "module_purchase": "Stripe integration for module purchases",
        "module_access_control": "Middleware-based module access",
        "available_modules": [
          "tour",
          "hotel"
        ],
        "feature_flags": "Module feature flags system"
      },
      "hotel_module": [
        "Hotel CRUD operations",
        "Room type management",
        "Hotel reservations",
        "ICS calendar sync (pull from external calendars)",
        "Push reservations to hotels (ICS, JSON, Email adapters)",
        "Retry queue for failed pushes",
        "Background scheduler for sync and queue processing"
      ],
      "store_module": [
        "Module listing page",
        "Stripe Checkout integration",
        "Payment success page",
        "Webhook handling for payment events"
      ],
      "admin_features": [
        "Staff management",
        "Company profile management",
        "Settings and preferences",
        "Module switching interface",
        "Security settings"
      ]
    },
    "api_endpoints": {
      "authentication": [
        "/api/auth/register",
        "/api/auth/login",
        "/api/auth/me"
      ],
      "reservations": "/api/reservations/*",
      "customers": "/api/customers/*",
      "cari_accounts": "/api/cari/*",
      "cash_flow": "/api/cash/*",
      "reports": "/api/reports/*",
      "hotels": "/api/hotels/*",
      "store": [
        "/api/store/modules",
        "/api/store/create-checkout-session",
        "/api/store/webhook"
      ],
      "settings": "/api/settings/*"
    },
    "database_collections": [
      "companies",
      "users",
      "reservations",
      "customers",
      "cari_accounts",
      "transactions",
      "cash_flow",
      "vehicles",
      "tour_types",
      "seasonal_prices",
      "billing_events",
      "module_feature_flags",
      "hotels",
      "hotel_rooms",
      "hotel_prices",
      "hotel_reservations",
      "hotel_ics_events",
      "hotel_reservation_push_queue",
      "hotel_reservation_push_logs"
    ],
    "authentication": {
      "method": "JWT (JSON Web Tokens)",
      "password_hashing": "bcrypt",
      "token_storage": "HTTP-only cookies or localStorage",
      "protected_routes": "AdminRoute component and middleware"
    },
    "environment_variables": {
      "backend": [
        "MONGO_URL",
        "DB_NAME",
        "JWT_SECRET_KEY",
        "CORS_ORIGINS",
        "MODULES_ENABLED",
        "STRIPE_SECRET_KEY",
        "STRIPE_WEBHOOK_SECRET",
        "HOTEL_ICS_SYNC_ENABLED",
        "HOTEL_ICS_SYNC_INTERVAL_SECONDS",
        "HOTEL_PUSH_QUEUE_INTERVAL_SECONDS",
        "SMTP_HOST",
        "SMTP_PORT",
        "SMTP_USER",
        "SMTP_PASSWORD",
        "SMTP_FROM"
      ],
      "frontend": [
        "REACT_APP_BACKEND_URL",
        "WDS_SOCKET_PORT",
        "REACT_APP_ENABLE_VISUAL_EDITS",
        "ENABLE_HEALTH_CHECK"
      ]
    },
    "ports": {
      "frontend": 3000,
      "backend": 8000
    },
    "testing": {
      "backend_tests": "pytest in backend/modules/tests/",
      "test_files": [
        "test_module_access.py",
        "test_billing_webhook.py",
        "test_hotel_push_queue.py",
        "test_ics_sync.py"
      ]
    },
    "deployment": {
      "frontend": "Vercel or Render",
      "backend": "Render with Uvicorn",
      "database": "MongoDB Atlas (cloud)"
    }
  }
}
